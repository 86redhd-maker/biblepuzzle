<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë§ì”€ ì¡°ê° ë§ì¶”ê¸°</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600&display=swap');

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Noto Serif KR',serif;
      background:linear-gradient(135deg,#f5f1e8 0%,#e8dcc0 100%);
      min-height:100vh;padding:20px
    }
    .container{
      max-width:600px;margin:0 auto;background:#fff;border-radius:15px;
      box-shadow:0 10px 30px rgba(139,108,83,.2);overflow:hidden;min-height:80vh
    }

    /* í™ˆ í™”ë©´ */
    .home-screen{padding:60px 40px;text-align:center;background:linear-gradient(135deg,#8b6c53 0%,#a67c60 100%);color:#fff;position:relative}
    .admin-link{
      position:absolute;top:20px;right:20px;background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);
      padding:8px 15px;border-radius:20px;text-decoration:none;font-size:.9em;cursor:pointer;transition:.3s
    }
    .admin-link:hover{background:rgba(255,255,255,.3)}
    .home-screen h1{font-size:2.2em;margin-bottom:20px;font-weight:600}
    .home-screen p{font-size:1.1em;margin-bottom:40px;opacity:.9;line-height:1.6}
    .start-btn{
      background:#fff;color:#8b6c53;border:none;padding:15px 40px;font-size:1.2em;border-radius:50px;cursor:pointer;
      transition:.3s; font-weight:600; box-shadow:0 5px 15px rgba(0,0,0,.2)
    }
    .start-btn:hover{transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,.3)}

    /* í¼ì¦ í™”ë©´ */
    .puzzle-screen{display:none;padding:30px}
    .puzzle-header{text-align:center;margin-bottom:30px}
    .puzzle-header h2{color:#8b6c53;font-size:1.5em;margin-bottom:10px}
    .verse-info{background:#f8f6f0;padding:10px 20px;border-radius:25px;color:#8b6c53;font-weight:600;display:inline-block}
    .instruction{background:#e3f2fd;border-left:4px solid #2196f3;padding:15px;margin:20px 0;border-radius:0 10px 10px 0;color:#1976d2;font-size:.95em}
    .puzzle-area{background:#f8f6f0;border-radius:15px;padding:25px;margin-bottom:30px;min-height:300px}
    .puzzle-piece{
      background:#fff;border:3px solid #e8dcc0;border-radius:10px;padding:15px 20px;margin:8px 0;cursor:pointer;transition:.3s;
      box-shadow:0 3px 10px rgba(139,108,83,.1);font-size:1.05em;line-height:1.4;user-select:none;-webkit-tap-highlight-color:transparent
    }
    .puzzle-piece:hover{border-color:#8b6c53;transform:translateY(-2px);box-shadow:0 5px 15px rgba(139,108,83,.2)}
    .puzzle-piece:active{transform:scale(.98)}
    .puzzle-piece.selected{border-color:#ffc107!important;background:#fff8dc!important;box-shadow:0 0 20px rgba(255,193,7,.4)!important;transform:translateY(-3px)!important}
    .puzzle-piece.correct{border-color:#28a745;background:#f8fff8}

    .controls{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
    .btn{
      background:#8b6c53;color:#fff;border:none;padding:12px 25px;border-radius:25px;cursor:pointer;transition:.3s;font-weight:500
    }
    .btn:hover{background:#a67c60;transform:translateY(-2px)}
    .btn:disabled{background:#ccc;cursor:not-allowed;transform:none}
    .hint-btn{background:#17a2b8}
    .hint-btn:hover{background:#138496}

    /* ê²°ê³¼ í™”ë©´ */
    .result-screen{display:none;padding:30px;text-align:center}
    .result-title{font-size:1.8em;color:#28a745;margin-bottom:20px}
    .correct-verse{background:#f8fff8;border:2px solid #28a745;border-radius:15px;padding:25px;margin:20px 0;font-size:1.15em;line-height:1.6;color:#333}
    .explanation{background:#fff8dc;border-left:4px solid #8b6c53;padding:20px;margin:20px 0;text-align:left;border-radius:0 10px 10px 0}
    .explanation h4{color:#8b6c53;margin-bottom:10px}
    .share-controls{margin-top:30px}
    .new-game-btn{background:#8b6c53;margin-top:15px}

    /* ê´€ë¦¬ì í™”ë©´ */
    .admin-screen{display:none;padding:30px}
    .admin-header{text-align:center;margin-bottom:30px;color:#8b6c53}
    .verse-list{margin-bottom:30px}
    .verse-item{background:#f8f6f0;border-radius:10px;padding:20px;margin-bottom:15px;border-left:4px solid #8b6c53}
    .verse-reference{font-weight:600;color:#8b6c53;margin-bottom:10px}
    .verse-pieces{margin-bottom:10px;line-height:1.5}
    .verse-explanation{font-size:.9em;color:#666;font-style:italic}
    .verse-actions{margin-top:10px}
    .edit-btn{background:#17a2b8;font-size:.9em;padding:8px 15px;margin-right:10px}
    .delete-btn{background:#dc3545;font-size:.9em;padding:8px 15px}
    .admin-form{background:#fff;border-radius:15px;padding:25px;box-shadow:0 5px 15px rgba(139,108,83,.1);margin-bottom:20px}
    .form-group{margin-bottom:20px}
    .form-label{display:block;color:#8b6c53;font-weight:600;margin-bottom:8px}
    .form-input{width:100%;padding:12px 15px;border:2px solid #e8dcc0;border-radius:8px;font-family:inherit;transition:border-color .3s}
    .form-input:focus{outline:none;border-color:#8b6c53}
    .form-textarea{min-height:120px;resize:vertical}
    .pieces-input{margin-bottom:10px}
    .add-piece-btn{background:#28a745;font-size:.9em;padding:8px 15px}
    .piece-item{display:flex;gap:10px;margin-bottom:10px;align-items:center}
    .piece-input{flex:1}
    .remove-piece-btn{background:#dc3545;font-size:.8em;padding:5px 10px}
    .back-btn{background:#6c757d}

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width:768px){
      .container{margin:10px;border-radius:10px}
      .home-screen{padding:40px 20px}
      .home-screen h1{font-size:1.8em}
      .puzzle-screen,.result-screen,.admin-screen{padding:20px}
      .puzzle-piece{padding:12px 15px;font-size:1em}
      .controls{flex-direction:column;align-items:center}
      .admin-link{position:static;display:inline-block;margin-bottom:20px}
    }

    .hidden{display:none!important}
    .password-modal{
      position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);
      display:flex;justify-content:center;align-items:center;z-index:1000
    }
    .password-modal-content{background:#fff;padding:30px;border-radius:15px;text-align:center;max-width:400px;width:90%}
    .password-input{
      width:100%;padding:12px;margin:20px 0;border:2px solid #e8dcc0;border-radius:8px;text-align:center;font-size:1.1em
    }

    /* ì¶”ê°€ëœ ë¯¸ë‹ˆ í†¤ì—… CSS */
    :root{--bg:#fafbff;--card:#fff;--ink:#1f2937;--sub:#6b7280;--pri:#6ea8fe;--ok:#65c18c;--warn:#fbc02d;--err:#ef5350;--radius:14px;--radius-sm:10px;--shadow:0 10px 30px rgba(17,24,39,.08)}
    html,body{height:100%}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;backdrop-filter:saturate(120%) blur(4px)}
    h1,h2,h3{line-height:1.2;margin:.6em 0 .4em}
    h1{font-size:clamp(24px,4.5vw,36px);letter-spacing:.2px}
    h2{font-size:clamp(20px,3.5vw,28px);color:var(--ink)}
    p.lead{color:var(--sub);font-size:1.05rem}
    .btn{display:inline-flex;align-items:center;gap:.5rem;justify-content:center;min-height:44px}
    .toolbar{position:sticky;bottom:12px;display:flex;gap:8px;flex-wrap:wrap;background:rgba(255,255,255,.7);backdrop-filter:blur(10px);padding:10px;border-radius:999px;box-shadow:var(--shadow)}
    .puzzle{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0 18px}
    .piece{padding:10px 14px;background:#fff;border:1px solid rgba(31,41,55,.12);border-radius:var(--radius-sm);box-shadow:0 2px 8px rgba(31,41,55,.06);line-height:1.35;cursor:pointer;transition:.15s}
    .piece:hover{transform:translateY(-1px)}
    .piece.selected{outline:2px solid var(--pri);background:rgba(110,168,254,.08)}
    .piece.correct{background:rgba(101,193,140,.10);border-color:rgba(101,193,140,.40)}
    .helper{color:var(--sub);font-size:.95rem}
    .result-toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:999px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:.25s}
    .result-toast.show{opacity:1;transform:translate(-50%,4px)}
  </style>
</head>
<body>
  <div class="container">
    <!-- í™ˆ í™”ë©´ -->
    <div class="home-screen" id="homeScreen">
      <button class="admin-link" onclick="showPasswordModal()">âš™ï¸ ê´€ë¦¬ì</button>
      <h1>ğŸ§© ë§ì”€ ì¡°ê° ë§ì¶”ê¸°</h1>
      <p>ì„±ê²½ êµ¬ì ˆì˜ ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!<br/>ë§ì”€ì˜ íë¦„ì„ ëŠë¼ë©° ë” ê¹Šì´ ë¬µìƒí•´ë³´ì•„ìš”.</p>
      <button class="start-btn" onclick="startGame()">ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- í¼ì¦ í™”ë©´ -->
    <div class="puzzle-screen" id="puzzleScreen">
      <div class="puzzle-header">
        <h2>ë§ì”€ ì¡°ê°ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•´ë³´ì„¸ìš”</h2>
        <div class="verse-info" id="verseInfo">ë§ˆíƒœë³µìŒ 5:14-16</div>
      </div>

      <div class="instruction">
        ğŸ“± <strong>ì‚¬ìš©ë²•:</strong> ì²« ë²ˆì§¸ ì¡°ê°ì„ í´ë¦­í•˜ê³ , ë°”ê¾¸ê³  ì‹¶ì€ ë‘ ë²ˆì§¸ ì¡°ê°ì„ í´ë¦­í•˜ë©´ ìœ„ì¹˜ê°€ ë°”ë€ë‹ˆë‹¤!
      </div>

      <div class="puzzle-area" id="puzzleArea"></div>

      <div class="controls">
        <button class="btn hint-btn" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
        <button class="btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
        <button class="btn" onclick="resetPuzzle()">ë‹¤ì‹œ ì„ê¸°</button>
        <button class="btn back-btn" onclick="goHome()">ğŸ  í™ˆ</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="result-screen" id="resultScreen">
      <h2 class="result-title">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</h2>
      <div class="correct-verse" id="correctVerse"></div>

      <div class="explanation">
        <h4>ğŸ“– ë§ì”€ ë¬µìƒ</h4>
        <p id="explanation"></p>
      </div>

      <div class="share-controls">
        <button class="btn" onclick="saveResult()">ğŸ“± ê²°ê³¼ ì €ì¥</button>
        <button class="btn new-game-btn" onclick="newGame()">ìƒˆë¡œìš´ í¼ì¦</button>
        <button class="btn back-btn" onclick="goHome()">ğŸ  í™ˆ</button>
      </div>
    </div>

    <!-- ê´€ë¦¬ì í™”ë©´ -->
    <div class="admin-screen" id="adminScreen">
      <div class="admin-header">
        <h2>âš™ï¸ êµ¬ì ˆ ê´€ë¦¬</h2>
        <p>ì„±ê²½ êµ¬ì ˆì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
      </div>

      <!-- JSON Import/Export -->
      <div class="admin-tools" style="display:flex; gap:8px; margin:12px 0;">
        <button class="btn" id="btnExport" type="button">JSON ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn" id="btnImport" type="button">JSON ê°€ì ¸ì˜¤ê¸°</button>
        <input type="file" id="fileImport" accept="application/json" hidden />
      </div>

      <!-- ìƒˆ êµ¬ì ˆ ì¶”ê°€ í¼ -->
      <div class="admin-form">
        <h3 style="color:#8b6c53; margin-bottom:20px;">ìƒˆ êµ¬ì ˆ ì¶”ê°€</h3>

        <div class="form-group">
          <label class="form-label">êµ¬ì ˆ ì°¸ì¡° (ì˜ˆ: ë§ˆíƒœë³µìŒ 5:14-16)</label>
          <input type="text" class="form-input" id="newReference" placeholder="ì„±ê²½ì±… ì¥:ì ˆ"/>
        </div>

        <div class="form-group">
          <label class="form-label">ë§ì”€ ì¡°ê°ë“¤</label>
          <div id="piecesContainer">
            <div class="piece-item">
              <input type="text" class="form-input piece-input" placeholder="ì²« ë²ˆì§¸ ë¬¸ì¥"/>
              <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
            </div>
          </div>
          <button class="btn add-piece-btn" onclick="addPiece()" type="button">+ ì¡°ê° ì¶”ê°€</button>
        </div>

        <div class="form-group">
          <label class="form-label">ì„¤êµ í•´ì„¤</label>
          <textarea class="form-input form-textarea" id="newExplanation" placeholder="ì´ ë§ì”€ì˜ ì˜ë¯¸ì™€ êµí›ˆì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>

        <div style="text-align:center;">
          <button class="btn" onclick="saveVerse()" type="button">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          <button class="btn" onclick="clearForm()" type="button">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
      </div>

      <!-- ê¸°ì¡´ êµ¬ì ˆ ëª©ë¡ -->
      <div class="verse-list">
        <h3 style="color:#8b6c53; margin-bottom:20px;">ë“±ë¡ëœ êµ¬ì ˆë“¤</h3>
        <div id="verseListContainer"></div>
      </div>

      <div style="text-align:center; margin-top:30px;">
        <button class="btn back-btn" onclick="goHome()" type="button">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div class="password-modal hidden" id="passwordModal">
    <div class="password-modal-content">
      <h3 style="color:#8b6c53; margin-bottom:20px;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
      <input type="password" class="password-input" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"/>
      <div>
        <button class="btn" onclick="checkPassword()" type="button">í™•ì¸</button>
        <button class="btn back-btn" onclick="closePasswordModal()" type="button">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <script>
    // ê¸°ë³¸ ì„±ê²½ êµ¬ì ˆ ë°ì´í„°
    const defaultVerses = [
      {
        reference: "ë§ˆíƒœë³µìŒ 5:14-16",
        pieces: [
          "ë„ˆí¬ëŠ” ì„¸ìƒì˜ ë¹›ì´ë¼",
          "ì‚° ìœ„ì— ìˆëŠ” ë™ë„¤ê°€ ìˆ¨ê²¨ì§€ì§€ ëª»í•  ê²ƒì´ìš”",
          "ì‚¬ëŒì´ ë“±ë¶ˆì„ ì¼œì„œ ë§ ì•„ë˜ì— ë‘ì§€ ì•„ë‹ˆí•˜ê³ ",
          "ë“±ê²½ ìœ„ì— ë‘ë‚˜ë‹ˆ",
          "ì´ê°™ì´ ë„ˆí¬ ë¹›ì´ ì‚¬ëŒ ì•ì— ë¹„ì¹˜ê²Œ í•˜ì—¬",
          "ê·¸ë“¤ë¡œ ë„ˆí¬ ì°©í•œ í–‰ì‹¤ì„ ë³´ê³ ",
          "í•˜ëŠ˜ì— ê³„ì‹  ë„ˆí¬ ì•„ë²„ì§€ê»˜ ì˜ê´‘ì„ ëŒë¦¬ê²Œ í•˜ë¼"
        ],
        explanation: "ì´ ë§ì”€ì€ ê·¸ë¦¬ìŠ¤ë„ì¸ë“¤ì´ ì„¸ìƒì—ì„œ ë¹›ì˜ ì—­í• ì„ ê°ë‹¹í•´ì•¼ í•¨ì„ êµí›ˆí•©ë‹ˆë‹¤. ìš°ë¦¬ì˜ ì°©í•œ í–‰ì‹¤ê³¼ ì‚¶ì„ í†µí•´ í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ë“œëŸ¬ë‚´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
      },
      {
        reference: "ìš”í•œë³µìŒ 3:16",
        pieces: [
          "í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬",
          "ë…ìƒìë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ",
          "ì´ëŠ” ê·¸ë¥¼ ë¯¿ëŠ” ìë§ˆë‹¤",
          "ë©¸ë§í•˜ì§€ ì•Šê³ ",
          "ì˜ìƒì„ ì–»ê²Œ í•˜ë ¤ í•˜ì‹¬ì´ë¼"
        ],
        explanation: "ì„±ê²½ì—ì„œ ê°€ì¥ ì‚¬ë‘ë°›ëŠ” êµ¬ì ˆ ì¤‘ í•˜ë‚˜ë¡œ, í•˜ë‚˜ë‹˜ì˜ ë¬´ì¡°ê±´ì ì¸ ì‚¬ë‘ê³¼ êµ¬ì›ì˜ ì€í˜œë¥¼ ë³´ì—¬ì£¼ëŠ” ë§ì”€ì…ë‹ˆë‹¤."
      }
    ];

    // ìƒíƒœ
    let currentVerse = null;
    let shuffledPieces = [];
    let hintUsed = false;
    let editingIndex = -1;
    let selectedPiece = null;

    // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
    const ADMIN_PASSWORD = "jesus2024";

    // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    function loadVerses(){
      const saved = localStorage.getItem('bibleVerses');
      if (saved) return JSON.parse(saved);
      saveVerses(defaultVerses);
      return defaultVerses;
    }
    function saveVerses(verses){
      localStorage.setItem('bibleVerses', JSON.stringify(verses));
    }

    // ê²Œì„ í”Œë¡œìš°
    function startGame(){
      document.getElementById('homeScreen').style.display='none';
      document.getElementById('puzzleScreen').style.display='block';
      loadRandomVerse();
    }
    function goHome(){
      document.getElementById('puzzleScreen').style.display='none';
      document.getElementById('resultScreen').style.display='none';
      document.getElementById('adminScreen').style.display='none';
      document.getElementById('homeScreen').style.display='block';
    }

    function loadRandomVerse(){
      const verses = loadVerses();
      if (verses.length===0){
        alert('ë“±ë¡ëœ êµ¬ì ˆì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í™”ë©´ì—ì„œ êµ¬ì ˆì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
        goHome();
        return;
      }
      const randomIndex = Math.floor(Math.random()*verses.length);
      currentVerse = verses[randomIndex];
      document.getElementById('verseInfo').textContent = currentVerse.reference;

      shuffledPieces = [...currentVerse.pieces];
      for (let i=shuffledPieces.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [shuffledPieces[i],shuffledPieces[j]]=[shuffledPieces[j],shuffledPieces[i]];
      }
      renderPuzzle();
      hintUsed=false; selectedPiece=null;
    }

    function renderPuzzle(){
      const puzzleArea = document.getElementById('puzzleArea');
      puzzleArea.innerHTML='';
      shuffledPieces.forEach((piece,index)=>{
        const el=document.createElement('div');
        el.className='puzzle-piece';
        el.textContent=piece;
        el.dataset.index=index;
        el.addEventListener('click',()=>handlePieceClick(el));
        puzzleArea.appendChild(el);
      });
    }

    function handlePieceClick(clicked){
      if (!selectedPiece){
        selectedPiece=clicked; clicked.classList.add('selected'); return;
      }
      if (selectedPiece===clicked){
        clicked.classList.remove('selected'); selectedPiece=null; return;
      }
      const a = parseInt(selectedPiece.dataset.index,10);
      const b = parseInt(clicked.dataset.index,10);
      [shuffledPieces[a],shuffledPieces[b]]=[shuffledPieces[b],shuffledPieces[a]];
      selectedPiece.classList.remove('selected'); selectedPiece=null;
      renderPuzzle();
    }

    function showHint(){
      if (hintUsed) return;
      const firstPiece = currentVerse.pieces[0];
      document.querySelectorAll('.puzzle-piece').forEach(p=>{
        if (p.textContent===firstPiece){
          p.style.border='3px solid #ffc107';
          p.style.background='#fff8dc';
        }
      });
      alert(`ğŸ’¡ íŒíŠ¸: ì²« ë²ˆì§¸ ë¬¸ì¥ì€ "${firstPiece}"ì…ë‹ˆë‹¤.`);
      hintUsed=true;
    }

    function checkAnswer(){
      const ok = shuffledPieces.every((p,i)=>p===currentVerse.pieces[i]);
      if (ok) showResult(); else alert('ì•„ì§ ìˆœì„œê°€ ë§ì§€ ì•Šì•„ìš”! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. ğŸ˜Š');
    }

    function showResult(){
      document.getElementById('puzzleScreen').style.display='none';
      document.getElementById('resultScreen').style.display='block';
      document.getElementById('correctVerse').innerHTML =
        `<strong>${currentVerse.reference}</strong><br/><br/>${currentVerse.pieces.join(' ')}`;
      document.getElementById('explanation').textContent = currentVerse.explanation;
    }

    function resetPuzzle(){
      for (let i=shuffledPieces.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [shuffledPieces[i],shuffledPieces[j]]=[shuffledPieces[j],shuffledPieces[i]];
      }
      selectedPiece=null; renderPuzzle(); hintUsed=false;
    }

    function newGame(){
      document.getElementById('resultScreen').style.display='none';
      document.getElementById('puzzleScreen').style.display='block';
      loadRandomVerse();
    }

    function saveResult(){
      const text = `${currentVerse.reference}\n\n${currentVerse.pieces.join(' ')}\n\n${currentVerse.explanation}`;
      if (navigator.share){
        navigator.share({title:'ë§ì”€ ì¡°ê° ë§ì¶”ê¸° ê²°ê³¼', text});
      } else {
        navigator.clipboard.writeText(text).then(()=>alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹'))
          .catch(()=>{
            const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta);
            ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
            alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
          });
      }
    }

    // ê´€ë¦¬ì
    function showPasswordModal(){
      document.getElementById('passwordModal').classList.remove('hidden');
      document.getElementById('passwordInput').focus();
    }
    function closePasswordModal(){
      document.getElementById('passwordModal').classList.add('hidden');
      document.getElementById('passwordInput').value='';
    }
    function checkPassword(){
      const pw = document.getElementById('passwordInput').value;
      if (pw===ADMIN_PASSWORD){ closePasswordModal(); showAdminScreen(); }
      else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); document.getElementById('passwordInput').value=''; }
    }
    function showAdminScreen(){
      document.getElementById('homeScreen').style.display='none';
      document.getElementById('adminScreen').style.display='block';
      renderVerseList(); clearForm();
    }

    function renderVerseList(){
      const verses = loadVerses();
      const container = document.getElementById('verseListContainer');
      if (verses.length===0){
        container.innerHTML = '<p style="text-align:center;color:#999;">ë“±ë¡ëœ êµ¬ì ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return;
      }
      container.innerHTML = verses.map((v,i)=>`
        <div class="verse-item">
          <div class="verse-reference">${v.reference}</div>
          <div class="verse-pieces">${v.pieces.join(' ')}</div>
          <div class="verse-explanation">${v.explanation}</div>
          <div class="verse-actions">
            <button class="btn edit-btn" onclick="editVerse(${i})" type="button">âœï¸ ìˆ˜ì •</button>
            <button class="btn delete-btn" onclick="deleteVerse(${i})" type="button">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        </div>
      `).join('');
    }

    function addPiece(){
      const container=document.getElementById('piecesContainer');
      const div=document.createElement('div');
      div.className='piece-item';
      div.innerHTML=`
        <input type="text" class="form-input piece-input" placeholder="ìƒˆë¡œìš´ ë¬¸ì¥"/>
        <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
      `;
      container.appendChild(div);
    }

    function removePiece(btn){
      const container=document.getElementById('piecesContainer');
      if (container.children.length>1) btn.parentElement.remove();
      else alert('ìµœì†Œ í•˜ë‚˜ì˜ ì¡°ê°ì€ í•„ìš”í•©ë‹ˆë‹¤.');
    }

    function clearForm(){
      document.getElementById('newReference').value='';
      document.getElementById('newExplanation').value='';
      const container=document.getElementById('piecesContainer');
      container.innerHTML=`
        <div class="piece-item">
          <input type="text" class="form-input piece-input" placeholder="ì²« ë²ˆì§¸ ë¬¸ì¥"/>
          <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
        </div>
      `;
      editingIndex=-1;
    }

    function saveVerse(){
      const reference = document.getElementById('newReference').value.trim();
      const explanation = document.getElementById('newExplanation').value.trim();
      const pieceInputs = document.querySelectorAll('.piece-input');

      if (!reference){ alert('êµ¬ì ˆ ì°¸ì¡°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      if (!explanation){ alert('ì„¤êµ í•´ì„¤ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

      const pieces=[];
      pieceInputs.forEach(i=>{ const v=i.value.trim(); if (v) pieces.push(v); });
      if (pieces.length<2){ alert('ìµœì†Œ 2ê°œ ì´ìƒì˜ ì¡°ê°ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

      const newVerse = { reference, pieces, explanation };
      const verses = loadVerses();

      if (editingIndex>=0){ verses[editingIndex]=newVerse; alert('êµ¬ì ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨'); }
      else { verses.push(newVerse); alert('ìƒˆ êµ¬ì ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰'); }

      saveVerses(verses);
      renderVerseList();
      clearForm();
    }

    function editVerse(index){
      const verses=loadVerses();
      const verse=verses[index];
      document.getElementById('newReference').value=verse.reference;
      document.getElementById('newExplanation').value=verse.explanation;

      const container=document.getElementById('piecesContainer');
      container.innerHTML='';
      verse.pieces.forEach(p=>{
        const div=document.createElement('div');
        div.className='piece-item';
        div.innerHTML=`
          <input type="text" class="form-input piece-input" value="${p}"/>
          <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
        `;
        container.appendChild(div);
      });
      editingIndex=index;
      document.querySelector('.admin-form').scrollIntoView({behavior:'smooth'});
    }

    function deleteVerse(index){
      const verses=loadVerses();
      const verse=verses[index];
      if (confirm(`"${verse.reference}" êµ¬ì ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
        verses.splice(index,1);
        saveVerses(verses);
        renderVerseList();
        alert('êµ¬ì ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì—”í„°
    document.getElementById('passwordInput').addEventListener('keypress', (e)=>{
      if (e.key==='Enter') checkPassword();
    });

    // ì´ˆê¸° ë¡œë“œ: ê¸°ë³¸ê°’ ì„¸íŒ…
    window.addEventListener('load', ()=>{
      if (!localStorage.getItem('bibleVerses')) saveVerses(defaultVerses);
    });

    // ===== Import/Export ë°”ì¸ë”© =====
    document.addEventListener('DOMContentLoaded', function () {
      const btnExport = document.getElementById("btnExport");
      const btnImport = document.getElementById("btnImport");
      const fileInput = document.getElementById("fileImport");
      if (!btnExport || !btnImport || !fileInput) return;

      // Export
      btnExport.addEventListener("click", ()=>{
        const verses = loadVerses();
        const blob = new Blob([JSON.stringify(verses, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "biblepuzzle_verses.json";
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      // Import
      btnImport.addEventListener("click", ()=> fileInput.click());
      fileInput.addEventListener("change", async (e)=>{
        const file = e.target.files?.[0];
        if (!file) return;
        try{
          const text = await file.text();
          const data = JSON.parse(text);
          // ìŠ¤í‚¤ë§ˆ ê²€ì¦: reference/pieces í•„ìš”
          if (!Array.isArray(data)) throw new Error("ìµœìƒìœ„ê°€ ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
          for (const v of data){
            if (!v?.reference || !Array.isArray(v?.pieces)) {
              throw new Error("ê° í•­ëª©ì— referenceì™€ pieces(ë°°ì—´)ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
            }
          }
          saveVerses(data);
          renderVerseList();
          alert("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!");
        }catch(err){
          alert("ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: " + err.message);
        }finally{
          e.target.value = "";
        }
      });
    });
  </script>
</body>
</html>
