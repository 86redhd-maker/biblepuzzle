<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë§ì”€ ì¡°ê° ë§ì¶”ê¸°</title>
  <!-- SUIT í°íŠ¸ -->
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
  <style>
    /* ============================
       BiblePuzzle â€” Pastel Playful (Single File)
       ============================ */

    :root{
      --sky1:#a7d3ff; --sky2:#8fc6ff;
      --ink:#22324a; --sub:#5b6b7a; --edge:rgba(34,50,74,.12);
      --ok:#65c18c; --warn:#f0c443;
      --chip1:#BFE3FF; --chip2:#FFD1E5; --chip3:#FFF0A6; --chip4:#CCF3D2; --chip5:#E2D6FF;
      --r-card:26px; --r:14px;
      --shadow-lg:0 28px 80px rgba(17,24,39,.18);
      --shadow:0 10px 26px rgba(17,24,39,.14);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font:16px/1.65 'SUIT', -apple-system, 'Apple SD Gothic Neo', system-ui, sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      color:var(--ink);
      background:linear-gradient(180deg,var(--sky1),var(--sky2));
      padding:24px;
    }
    /* ë°°ê²½ ë°ì½”: í´ë¦­ ë§‰ì§€ ì•Šë„ë¡ ë’¤ë¡œ */
    body::after{
      content:""; position:fixed; inset:0;
      pointer-events:none; z-index:-1; opacity:.95;
      background-image:
        /* í° êµ¬ë¦„ */
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='260' height='120'><path fill='%23fff' fill-opacity='.94' d='M50 95h160a44 44 0 1 0-30-76 60 60 0 0 0-98 28 30 30 0 1 0-32 48z'/></svg>"),
        /* ì‘ì€ êµ¬ë¦„ */
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='100'><path fill='%23fff' fill-opacity='.92' d='M36 84h128a34 34 0 1 0-24-56 60 60 0 0 0-82 30 24 24 0 1 0-22 26z'/></svg>"),
        /* í¼ì¦(ë…¸ë‘) */
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='110' height='110' viewBox='0 0 84 84'><path fill='%23ffd36b' d='M30 8a8 8 0 1 0 16 0h10c8 0 14 6 14 14v6a 8 8 0 1 0 0 16v8c0 8-6 14-14 14H46a8 8 0 1 0-16 0H20c-8 0-14-6-14-14V44a8 8 0 1 0 0-16v-6C6 14 12 8 20 8h10z'/></svg>"),
        /* í¼ì¦(í•‘í¬) */
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='110' height='110' viewBox='0 0 84 84'><path fill='%23ffb3c7' d='M30 8a8 8 0 1 0 16 0h10c8 0 14 6 14 14v6a 8 8 0 1 0 0 16v8c0 8-6 14-14 14H46a8 8 0 1 0-16 0H20c-8 0-14-6-14-14V44a8 8 0 1 0 0-16v-6C6 14 12 8 20 8h10z'/></svg>");
      background-repeat:no-repeat,no-repeat,no-repeat,no-repeat;
      background-size:260px 120px,200px 100px,110px,110px;
      background-position:8% 14%,86% 10%,10% 84%,90% 78%;
    }

    .container{max-width:980px;margin:0 auto;position:relative;z-index:0}

    /* í™ˆ(íˆì–´ë¡œ) */
    .home-screen{
      display:grid;place-items:center;text-align:center;gap:16px;
      min-height:64vh;padding:56px 28px;
      background:linear-gradient(180deg,rgba(255,255,255,.86),rgba(255,255,255,.94));
      border:1px solid rgba(255,255,255,.85);border-radius:var(--r-card);
      box-shadow:var(--shadow-lg);color:var(--ink);overflow:hidden;
    }
    .admin-link{
      position:absolute;top:20px;right:20px;z-index:2;
      background:rgba(255,255,255,.8);color:#234a83;border:1px solid rgba(0,0,0,.06);
      padding:8px 14px;border-radius:999px;font-size:.9rem;cursor:pointer;
      box-shadow:0 6px 14px rgba(0,0,0,.12);transition:transform .15s;
    }
    .admin-link:hover{transform:translateY(-1px)}
    .home-screen h1{
      font-size:clamp(42px,7vw,68px);font-weight:900;letter-spacing:.6px;color:#fff;
      text-shadow:
        -3px -3px 0 #2b4a7a, 3px -3px 0 #2b4a7a, -3px 3px 0 #2b4a7a, 3px 3px 0 #2b4a7a,
        0 6px 16px rgba(0,0,0,.18);
      background:linear-gradient(90deg,#6aa8ff,#92d6ff,#ff99c2,#ffd36b,#7ed98a);
      -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
    }
    .home-screen p{font-size:clamp(15px,2.2vw,18px);color:#375075}
    .start-btn{
      border:0;padding:14px 34px;border-radius:18px;font-weight:900;font-size:clamp(18px,3vw,22px);
      color:#fff;cursor:pointer;background:linear-gradient(180deg,#59a3ff,#2f83ff);
      box-shadow:0 10px 0 #2a67cc,0 16px 34px rgba(0,0,0,.22);
      transform:translateY(0);transition:transform .12s,box-shadow .12s;
    }
    .start-btn:hover{transform:translateY(-2px);box-shadow:0 12px 0 #2a67cc,0 20px 40px rgba(0,0,0,.24)}
    .start-btn:active{transform:translateY(0);box-shadow:0 8px 0 #2a67cc,0 12px 28px rgba(0,0,0,.2)}

    /* í¼ì¦ í™”ë©´ */
    .puzzle-screen{display:none;position:relative;padding:28px 28px 36px}
    .puzzle-screen::before{
      content:"";position:absolute;inset:10px;z-index:-1;border-radius:22px;
      background:linear-gradient(180deg,rgba(255,255,255,.82),rgba(255,255,255,.94));
      border:1px solid rgba(255,255,255,.85);box-shadow:0 20px 60px rgba(17,24,39,.14);
      backdrop-filter:blur(4px) saturate(115%);
    }
    .puzzle-header{text-align:center;margin-bottom:18px}
    .puzzle-header h2{font-size:clamp(20px,3.2vw,26px);font-weight:900;color:#1e2b46;margin-bottom:8px}
    .verse-info{
      display:inline-flex;align-items:center;gap:.5rem;background:#fff;color:#334155;font-weight:900;
      border:1px solid var(--edge);padding:8px 14px;border-radius:999px;
      box-shadow:0 6px 16px rgba(17,24,39,.08);
    }
    .instruction{
      background:linear-gradient(180deg,#eef6ff,#eaf2ff);
      border:1px solid rgba(110,168,254,.35);
      color:#0f3a75;border-radius:14px;padding:14px 16px;font-weight:800;margin:18px 0 20px;
    }
    .puzzle-area{
      display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
      background:linear-gradient(180deg,#fbfdff,#f5f8fe);border:1px solid rgba(34,50,74,.10);
      border-radius:16px;padding:18px;min-height:260px;box-shadow:0 12px 26px rgba(17,24,39,.08) inset;
    }
    .puzzle-piece{
      border:none;border-radius:14px;padding:14px 16px;font-weight:900;line-height:1.4;color:#253551;
      box-shadow:0 10px 22px rgba(34,50,74,.10);user-select:none;-webkit-tap-highlight-color:transparent;
      transition:transform .12s ease,box-shadow .12s ease,filter .12s ease;
    }
    .puzzle-piece:hover{transform:translateY(-2px);box-shadow:0 16px 28px rgba(34,50,74,.14)}
    .puzzle-piece:active{transform:scale(.985)}
    .puzzle-piece.selected{outline:3px solid rgba(110,168,254,.55);filter:saturate(110%)}
    .puzzle-piece:nth-child(5n+1){background:var(--chip1)}
    .puzzle-piece:nth-child(5n+2){background:var(--chip2)}
    .puzzle-piece:nth-child(5n+3){background:var(--chip3)}
    .puzzle-piece:nth-child(5n+4){background:var(--chip4)}
    .puzzle-piece:nth-child(5n){background:var(--chip5)}

    .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .btn{
      border:1px solid var(--edge);
      background:radial-gradient(120% 100% at 50% -10%,rgba(255,255,255,.65),transparent 40%),linear-gradient(#fff,#f7f7f7);
      color:#1f2d40;font-weight:800;min-height:44px;padding:12px 18px;border-radius:999px;cursor:pointer;
      box-shadow:0 6px 18px rgba(31,41,55,.12);transition:transform .15s,box-shadow .15s;
    }
    .btn:hover{transform:translateY(-1px) scale(1.01)}
    .btn:active{transform:translateY(0) scale(.99)}
    .hint-btn{background:linear-gradient(#eaf4ff,#e2f0ff);border-color:rgba(110,168,254,.45);color:#0f3a75}
    .back-btn{background:linear-gradient(#f5f5f5,#eeeeee)}

    /* ê²°ê³¼ í™”ë©´ */
    .result-screen{display:none;position:relative;padding:28px;text-align:center}
    .result-screen::before{
      content:"";position:absolute;inset:10px;z-index:-1;border-radius:22px;
      background:linear-gradient(180deg,rgba(255,255,255,.82),rgba(255,255,255,.94));
      border:1px solid rgba(255,255,255,.85);box-shadow:0 20px 60px rgba(17,24,39,.14);
      backdrop-filter:blur(4px) saturate(115%);
    }
    .result-title{font-size:clamp(22px,3.6vw,28px);color:var(--ok);font-weight:900;margin-bottom:14px}
    .correct-verse{
      background:linear-gradient(180deg,#fcfffb,#f7fff7);border:1px solid rgba(101,193,140,.45);
      border-radius:18px;padding:22px;margin:18px 0;box-shadow:0 12px 32px rgba(17,24,39,.10);
      font-size:1.08rem;line-height:1.65;color:#1f2937;font-weight:800;
    }
    .explanation{
      background:linear-gradient(180deg,#fff9e6,#fff4d6);border-left:4px solid var(--warn);
      border-radius:10px;padding:18px;margin:16px 0;text-align:left;color:#374151;font-weight:800;
    }
    .explanation h4{color:#8b6c53;margin:0 0 8px}

    /* ê´€ë¦¬ì í™”ë©´ */
    .admin-screen{display:none;padding:28px}
    .admin-header{text-align:center;color:#8b6c53;margin-bottom:22px}
    .verse-list{margin-bottom:24px}
    .verse-item{
      background:linear-gradient(180deg,#f9fafb,#f7f7f7);border:1px solid rgba(17,24,39,.08);
      border-left:4px solid #8b6c53;border-radius:14px;padding:18px;margin-bottom:12px;
    }
    .verse-reference{font-weight:900;color:#8b6c53;margin-bottom:8px;letter-spacing:.2px}
    .verse-pieces{margin-bottom:8px;line-height:1.55;color:#111827;font-weight:800}
    .verse-explanation{font-size:.95rem;color:#6b7280}
    .verse-actions{margin-top:10px}

    .admin-form{
      background:#fff;border:1px solid rgba(17,24,39,.08);border-radius:16px;padding:22px;
      box-shadow:0 8px 20px rgba(17,24,39,.06);margin-bottom:18px;
    }
    .form-group{margin-bottom:16px}
    .form-label{display:block;color:#8b6c53;font-weight:900;margin-bottom:8px}
    .form-input{
      width:100%;padding:12px 14px;border:1px solid rgba(34,50,74,.14);border-radius:10px;font:inherit;
      transition:border-color .15s;
    }
    .form-input:focus{outline:none;border-color:rgba(110,168,254,.6)}
    .form-textarea{min-height:120px;resize:vertical}
    .piece-item{display:flex;gap:10px;align-items:center;margin-bottom:10px}
    .piece-input{flex:1}
    .add-piece-btn{background:linear-gradient(#eafdf0,#e1f9ea);color:#0d5e34;border-color:rgba(101,193,140,.45)}
    .remove-piece-btn{background:linear-gradient(#ffe9ea,#ffdfe1);border-color:rgba(239,83,80,.35)}
    .edit-btn{background:linear-gradient(#eaf4ff,#e2f0ff);border-color:rgba(110,168,254,.45);color:#0f3a75}
    .delete-btn{background:linear-gradient(#ffe9ea,#ffdfe1)}
    .back-btn{background:linear-gradient(#f5f5f5,#eeeeee)}

    /* ëª¨ë‹¬ */
    .password-modal{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;
      background:rgba(15,23,42,.45);backdrop-filter:blur(6px);z-index:1000}
    .password-modal-content{
      background:linear-gradient(180deg,#ffffff,#fbfbfb);
      border:1px solid rgba(255,255,255,.7);border-radius:16px;padding:26px;width:min(420px,92%);
      box-shadow:var(--shadow);text-align:center;
    }
    .password-input{
      width:100%;padding:12px;margin:16px 0;border:1px solid rgba(34,50,74,.14);border-radius:10px;text-align:center;font-size:1.05rem;
    }
    .hidden{display:none!important}

    /* ëª¨ë°”ì¼ */
    @media (max-width:768px){
      body{padding:16px}
      .home-screen{min-height:58vh;padding:40px 18px}
      .puzzle-screen,.result-screen,.admin-screen{padding:22px}
      .puzzle-area{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    }

    /* ì•ˆì „ì¥ì¹˜ */
    button,.btn,.start-btn{pointer-events:auto}
  </style>
</head>
<body>
  <div class="container">
    <!-- í™ˆ í™”ë©´ -->
    <div class="home-screen" id="homeScreen">
      <button class="admin-link" onclick="showPasswordModal()">âš™ï¸ ê´€ë¦¬ì</button>
      <h1>ğŸ§© ë§ì”€ ì¡°ê° ë§ì¶”ê¸°</h1>
      <p>ì„±ê²½ êµ¬ì ˆì˜ ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!<br>ë§ì”€ì˜ íë¦„ì„ ëŠë¼ë©° ë” ê¹Šì´ ë¬µìƒí•´ë³´ì•„ìš”.</p>
      <button class="start-btn" onclick="startGame()">Start</button>
    </div>

    <!-- í¼ì¦ í™”ë©´ -->
    <div class="puzzle-screen" id="puzzleScreen">
      <div class="puzzle-header">
        <h2>ë§ì”€ ì¡°ê°ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•´ë³´ì„¸ìš”</h2>
        <div class="verse-info" id="verseInfo">ë§ˆíƒœë³µìŒ 5:14-16</div>
      </div>

      <div class="instruction">
        ğŸ“± <strong>ì‚¬ìš©ë²•:</strong> ì²« ë²ˆì§¸ ì¡°ê°ì„ í´ë¦­í•˜ê³ , ë°”ê¾¸ê³  ì‹¶ì€ ë‘ ë²ˆì§¸ ì¡°ê°ì„ í´ë¦­í•˜ë©´ ìœ„ì¹˜ê°€ ë°”ë€ë‹ˆë‹¤!
      </div>

      <div class="puzzle-area" id="puzzleArea"></div>

      <div class="controls">
        <button class="btn hint-btn" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
        <button class="btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
        <button class="btn" onclick="resetPuzzle()">ë‹¤ì‹œ ì„ê¸°</button>
        <button class="btn back-btn" onclick="goHome()">ğŸ  í™ˆ</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="result-screen" id="resultScreen">
      <h2 class="result-title">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</h2>
      <div class="correct-verse" id="correctVerse"></div>
      <div class="explanation">
        <h4>ğŸ“– ë§ì”€ ë¬µìƒ</h4>
        <p id="explanation"></p>
      </div>
      <div class="share-controls">
        <button class="btn" onclick="saveResult()">ğŸ“± ê²°ê³¼ ì €ì¥</button>
        <button class="btn new-game-btn" onclick="newGame()">ìƒˆë¡œìš´ í¼ì¦</button>
        <button class="btn back-btn" onclick="goHome()">ğŸ  í™ˆ</button>
      </div>
    </div>

    <!-- ê´€ë¦¬ì í™”ë©´ -->
    <div class="admin-screen" id="adminScreen">
      <div class="admin-header">
        <h2>âš™ï¸ êµ¬ì ˆ ê´€ë¦¬</h2>
        <p>ì„±ê²½ êµ¬ì ˆì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
      </div>

      <!-- JSON Import/Export -->
      <div class="admin-tools" style="display:flex; gap:8px; margin:12px 0;">
        <button class="btn" id="btnExport" type="button">JSON ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn" id="btnImport" type="button">JSON ê°€ì ¸ì˜¤ê¸°</button>
        <input type="file" id="fileImport" accept="application/json" hidden>
      </div>

      <!-- ìƒˆ êµ¬ì ˆ ì¶”ê°€ í¼ -->
      <div class="admin-form">
        <h3 style="color:#8b6c53; margin-bottom:20px;">ìƒˆ êµ¬ì ˆ ì¶”ê°€</h3>

        <div class="form-group">
          <label class="form-label">êµ¬ì ˆ ì°¸ì¡° (ì˜ˆ: ë§ˆíƒœë³µìŒ 5:14-16)</label>
          <input type="text" class="form-input" id="newReference" placeholder="ì„±ê²½ì±… ì¥:ì ˆ">
        </div>

        <div class="form-group">
          <label class="form-label">ë§ì”€ ì¡°ê°ë“¤</label>
          <div id="piecesContainer">
            <div class="piece-item">
              <input type="text" class="form-input piece-input" placeholder="ì²« ë²ˆì§¸ ë¬¸ì¥">
              <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
            </div>
          </div>
          <button class="btn add-piece-btn" onclick="addPiece()" type="button">+ ì¡°ê° ì¶”ê°€</button>
        </div>

        <div class="form-group">
          <label class="form-label">ì„¤êµ í•´ì„¤</label>
          <textarea class="form-input form-textarea" id="newExplanation" placeholder="ì´ ë§ì”€ì˜ ì˜ë¯¸ì™€ êµí›ˆì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>

        <div style="text-align:center;">
          <button class="btn" onclick="saveVerse()" type="button">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          <button class="btn" onclick="clearForm()" type="button">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
      </div>

      <!-- ê¸°ì¡´ êµ¬ì ˆ ëª©ë¡ -->
      <div class="verse-list">
        <h3 style="color:#8b6c53; margin-bottom:20px;">ë“±ë¡ëœ êµ¬ì ˆë“¤</h3>
        <div id="verseListContainer"></div>
      </div>

      <div style="text-align:center; margin-top:30px;">
        <button class="btn back-btn" onclick="goHome()" type="button">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div class="password-modal hidden" id="passwordModal">
    <div class="password-modal-content">
      <h3 style="color:#8b6c53; margin-bottom:20px;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
      <input type="password" class="password-input" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      <div>
        <button class="btn" onclick="checkPassword()" type="button">í™•ì¸</button>
        <button class="btn back-btn" onclick="closePasswordModal()" type="button">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <script>
    // === ê¸°ë³¸ ë°ì´í„° ===
    const defaultVerses = [
      {
        reference: "ë§ˆíƒœë³µìŒ 5:14-16",
        pieces: [
          "ë„ˆí¬ëŠ” ì„¸ìƒì˜ ë¹›ì´ë¼",
          "ì‚° ìœ„ì— ìˆëŠ” ë™ë„¤ê°€ ìˆ¨ê²¨ì§€ì§€ ëª»í•  ê²ƒì´ìš”",
          "ì‚¬ëŒì´ ë“±ë¶ˆì„ ì¼œì„œ ë§ ì•„ë˜ì— ë‘ì§€ ì•„ë‹ˆí•˜ê³ ",
          "ë“±ê²½ ìœ„ì— ë‘ë‚˜ë‹ˆ",
          "ì´ê°™ì´ ë„ˆí¬ ë¹›ì´ ì‚¬ëŒ ì•ì— ë¹„ì¹˜ê²Œ í•˜ì—¬",
          "ê·¸ë“¤ë¡œ ë„ˆí¬ ì°©í•œ í–‰ì‹¤ì„ ë³´ê³ ",
          "í•˜ëŠ˜ì— ê³„ì‹  ë„ˆí¬ ì•„ë²„ì§€ê»˜ ì˜ê´‘ì„ ëŒë¦¬ê²Œ í•˜ë¼"
        ],
        explanation: "ì´ ë§ì”€ì€ ê·¸ë¦¬ìŠ¤ë„ì¸ë“¤ì´ ì„¸ìƒì—ì„œ ë¹›ì˜ ì—­í• ì„ ê°ë‹¹í•´ì•¼ í•¨ì„ êµí›ˆí•©ë‹ˆë‹¤. ìš°ë¦¬ì˜ ì°©í•œ í–‰ì‹¤ê³¼ ì‚¶ì„ í†µí•´ í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ë“œëŸ¬ë‚´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
      },
      {
        reference: "ìš”í•œë³µìŒ 3:16",
        pieces: [
          "í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬",
          "ë…ìƒìë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ",
          "ì´ëŠ” ê·¸ë¥¼ ë¯¿ëŠ” ìë§ˆë‹¤",
          "ë©¸ë§í•˜ì§€ ì•Šê³ ",
          "ì˜ìƒì„ ì–»ê²Œ í•˜ë ¤ í•˜ì‹¬ì´ë¼"
        ],
        explanation: "ì„±ê²½ì—ì„œ ê°€ì¥ ì‚¬ë‘ë°›ëŠ” êµ¬ì ˆ ì¤‘ í•˜ë‚˜ë¡œ, í•˜ë‚˜ë‹˜ì˜ ë¬´ì¡°ê±´ì ì¸ ì‚¬ë‘ê³¼ êµ¬ì›ì˜ ì€í˜œë¥¼ ë³´ì—¬ì£¼ëŠ” ë§ì”€ì…ë‹ˆë‹¤."
      }
    ];

    // === ìƒíƒœ ===
    let currentVerse = null;
    let shuffledPieces = [];
    let hintUsed = false;
    let editingIndex = -1;
    let selectedPiece = null;
    const ADMIN_PASSWORD = "jesus2024";

    // === ìŠ¤í† ë¦¬ì§€ ===
    function loadVerses(){
      const saved = localStorage.getItem('bibleVerses');
      if (saved) return JSON.parse(saved);
      saveVerses(defaultVerses);
      return defaultVerses;
    }
    function saveVerses(verses){
      localStorage.setItem('bibleVerses', JSON.stringify(verses));
    }

    // === í™”ë©´ ì „í™˜ ===
    function startGame(){
      document.getElementById('homeScreen').style.display='none';
      document.getElementById('puzzleScreen').style.display='block';
      loadRandomVerse();
    }
    function goHome(){
      document.getElementById('puzzleScreen').style.display='none';
      document.getElementById('resultScreen').style.display='none';
      document.getElementById('adminScreen').style.display='none';
      document.getElementById('homeScreen').style.display='block';
    }

    // === í¼ì¦ ===
    function loadRandomVerse(){
      const verses = loadVerses();
      if (verses.length===0){
        alert('ë“±ë¡ëœ êµ¬ì ˆì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í™”ë©´ì—ì„œ êµ¬ì ˆì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
        goHome(); return;
      }
      const i = Math.floor(Math.random()*verses.length);
      currentVerse = verses[i];
      document.getElementById('verseInfo').textContent = currentVerse.reference;

      shuffledPieces = [...currentVerse.pieces];
      for (let j=shuffledPieces.length-1;j>0;j--){
        const k = Math.floor(Math.random()*(j+1));
        [shuffledPieces[j],shuffledPieces[k]]=[shuffledPieces[k],shuffledPieces[j]];
      }
      renderPuzzle();
      hintUsed=false; selectedPiece=null;
    }

    function renderPuzzle(){
      const area = document.getElementById('puzzleArea');
      area.innerHTML='';
      shuffledPieces.forEach((txt,idx)=>{
        const el = document.createElement('div');
        el.className='puzzle-piece';
        el.textContent=txt;
        el.dataset.index=idx;
        el.addEventListener('click',()=>handlePieceClick(el));
        area.appendChild(el);
      });
    }

    function handlePieceClick(el){
      if (!selectedPiece){ selectedPiece=el; el.classList.add('selected'); return; }
      if (selectedPiece===el){ el.classList.remove('selected'); selectedPiece=null; return; }

      const a = +selectedPiece.dataset.index;
      const b = +el.dataset.index;
      [shuffledPieces[a],shuffledPieces[b]]=[shuffledPieces[b],shuffledPieces[a]];
      selectedPiece.classList.remove('selected'); selectedPiece=null;
      renderPuzzle();
    }

    function showHint(){
      if (hintUsed) return;
      const first = currentVerse.pieces[0];
      document.querySelectorAll('.puzzle-piece').forEach(p=>{
        if (p.textContent===first){ p.style.border='3px solid #ffc107'; p.style.background='#fff8dc'; }
      });
      alert(`ğŸ’¡ íŒíŠ¸: ì²« ë²ˆì§¸ ë¬¸ì¥ì€ "${first}"ì…ë‹ˆë‹¤.`);
      hintUsed=true;
    }

    function checkAnswer(){
      const ok = shuffledPieces.every((p,i)=>p===currentVerse.pieces[i]);
      if (ok) showResult();
      else alert('ì•„ì§ ìˆœì„œê°€ ë§ì§€ ì•Šì•„ìš”! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. ğŸ˜Š');
    }

    function showResult(){
      document.getElementById('puzzleScreen').style.display='none';
      document.getElementById('resultScreen').style.display='block';
      document.getElementById('correctVerse').innerHTML =
        `<strong>${currentVerse.reference}</strong><br><br>${currentVerse.pieces.join(' ')}`;
      document.getElementById('explanation').textContent = currentVerse.explanation;
    }

    function resetPuzzle(){
      for (let i=shuffledPieces.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [shuffledPieces[i],shuffledPieces[j]]=[shuffledPieces[j],shuffledPieces[i]];
      }
      selectedPiece=null; renderPuzzle(); hintUsed=false;
    }

    function newGame(){
      document.getElementById('resultScreen').style.display='none';
      document.getElementById('puzzleScreen').style.display='block';
      loadRandomVerse();
    }

    function saveResult(){
      const text = `${currentVerse.reference}\n\n${currentVerse.pieces.join(' ')}\n\n${currentVerse.explanation}`;
      if (navigator.share){ navigator.share({title:'ë§ì”€ ì¡°ê° ë§ì¶”ê¸° ê²°ê³¼', text}); }
      else {
        navigator.clipboard.writeText(text).then(()=>alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹'))
        .catch(()=>{
          const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
          alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        });
      }
    }

    // === ê´€ë¦¬ì ===
    function showPasswordModal(){
      document.getElementById('passwordModal').classList.remove('hidden');
      document.getElementById('passwordInput').focus();
    }
    function closePasswordModal(){
      document.getElementById('passwordModal').classList.add('hidden');
      document.getElementById('passwordInput').value='';
    }
    function checkPassword(){
      const pw = document.getElementById('passwordInput').value;
      if (pw===ADMIN_PASSWORD){ closePasswordModal(); showAdminScreen(); }
      else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); document.getElementById('passwordInput').value=''; }
    }
    function showAdminScreen(){
      document.getElementById('homeScreen').style.display='none';
      document.getElementById('adminScreen').style.display='block';
      renderVerseList(); clearForm();
    }

    function renderVerseList(){
      const verses = loadVerses();
      const container = document.getElementById('verseListContainer');
      if (verses.length===0){
        container.innerHTML='<p style="text-align:center;color:#999;">ë“±ë¡ëœ êµ¬ì ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return;
      }
      container.innerHTML = verses.map((v,i)=>`
        <div class="verse-item">
          <div class="verse-reference">${v.reference}</div>
          <div class="verse-pieces">${v.pieces.join(' ')}</div>
          <div class="verse-explanation">${v.explanation}</div>
          <div class="verse-actions">
            <button class="btn edit-btn" onclick="editVerse(${i})" type="button">âœï¸ ìˆ˜ì •</button>
            <button class="btn delete-btn" onclick="deleteVerse(${i})" type="button">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        </div>
      `).join('');
    }

    function addPiece(){
      const c=document.getElementById('piecesContainer');
      const div=document.createElement('div');
      div.className='piece-item';
      div.innerHTML=`
        <input type="text" class="form-input piece-input" placeholder="ìƒˆë¡œìš´ ë¬¸ì¥">
        <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
      `;
      c.appendChild(div);
    }

    function removePiece(btn){
      const c=document.getElementById('piecesContainer');
      if (c.children.length>1) btn.parentElement.remove();
      else alert('ìµœì†Œ í•˜ë‚˜ì˜ ì¡°ê°ì€ í•„ìš”í•©ë‹ˆë‹¤.');
    }

    function clearForm(){
      document.getElementById('newReference').value='';
      document.getElementById('newExplanation').value='';
      const c=document.getElementById('piecesContainer');
      c.innerHTML=`
        <div class="piece-item">
          <input type="text" class="form-input piece-input" placeholder="ì²« ë²ˆì§¸ ë¬¸ì¥">
          <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
        </div>
      `;
      editingIndex=-1;
    }

    function saveVerse(){
      const reference = document.getElementById('newReference').value.trim();
      const explanation = document.getElementById('newExplanation').value.trim();
      const pieceInputs = document.querySelectorAll('.piece-input');
      if (!reference){ alert('êµ¬ì ˆ ì°¸ì¡°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      if (!explanation){ alert('ì„¤êµ í•´ì„¤ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

      const pieces=[]; pieceInputs.forEach(i=>{ const v=i.value.trim(); if (v) pieces.push(v); });
      if (pieces.length<2){ alert('ìµœì†Œ 2ê°œ ì´ìƒì˜ ì¡°ê°ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

      const newVerse={reference,pieces,explanation};
      const verses=loadVerses();
      if (editingIndex>=0){ verses[editingIndex]=newVerse; alert('êµ¬ì ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨'); }
      else { verses.push(newVerse); alert('ìƒˆ êµ¬ì ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰'); }
      saveVerses(verses); renderVerseList(); clearForm();
    }

    function editVerse(index){
      const verses=loadVerses(); const v=verses[index];
      document.getElementById('newReference').value=v.reference;
      document.getElementById('newExplanation').value=v.explanation;

      const c=document.getElementById('piecesContainer'); c.innerHTML='';
      v.pieces.forEach(p=>{
        const div=document.createElement('div');
        div.className='piece-item';
        div.innerHTML=`
          <input type="text" class="form-input piece-input" value="${p}">
          <button class="btn remove-piece-btn" onclick="removePiece(this)" type="button">ì‚­ì œ</button>
        `;
        c.appendChild(div);
      });
      editingIndex=index;
      document.querySelector('.admin-form').scrollIntoView({behavior:'smooth'});
    }

    function deleteVerse(index){
      const verses=loadVerses(); const v=verses[index];
      if (confirm(`"${v.reference}" êµ¬ì ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
        verses.splice(index,1); saveVerses(verses); renderVerseList(); alert('êµ¬ì ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì´ˆê¸° ë¡œë“œ
    window.addEventListener('load', ()=>{
      if (!localStorage.getItem('bibleVerses')) saveVerses(defaultVerses);
    });

    // Import/Export
    document.addEventListener('DOMContentLoaded', ()=>{
      const btnExport=document.getElementById('btnExport');
      const btnImport=document.getElementById('btnImport');
      const fileInput=document.getElementById('fileImport');
      if (!btnExport||!btnImport||!fileInput) return;

      btnExport.addEventListener('click', ()=>{
        const verses=loadVerses();
        const blob=new Blob([JSON.stringify(verses,null,2)],{type:'application/json'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download='biblepuzzle_verses.json';
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      btnImport.addEventListener('click', ()=>fileInput.click());
      fileInput.addEventListener('change', async (e)=>{
        const file=e.target.files?.[0]; if(!file) return;
        try{
          const text=await file.text(); const data=JSON.parse(text);
          if(!Array.isArray(data)) throw new Error('ìµœìƒìœ„ê°€ ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
          for(const v of data){ if(!v?.reference || !Array.isArray(v?.pieces)) throw new Error('ê° í•­ëª©ì— referenceì™€ pieces(ë°°ì—´)ê°€ í•„ìš”í•©ë‹ˆë‹¤.'); }
          saveVerses(data); renderVerseList(); alert('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!');
        }catch(err){ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: '+err.message); }
        finally{ e.target.value=''; }
      });
    });
  </script>
</body>
</html>
